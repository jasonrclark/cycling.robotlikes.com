<html>
  <head>
    <link rel="stylesheet" href="https://jasonrclark.com/css/pixyll.css" type="text/css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-adapter-moment/1.0.0/chartjs-adapter-moment.min.js"></script>
    <script src="./code.js"></script>

    <style>
      h3 span {
        font-weight:normal;
      }
    </style>
  </head>
  <body style="width:1000px;">
    <h1 class="post-title">Robot Likes Cycling</h1>

    <div>
      <div style="float:left;height:400px;width:600px">
        <canvas id="perDistanceChart"></canvas>
      </div>
      <div style="padding:20px;float:left;">
        <h3>Max: <span id="maxDistance">boo</span></h3>
        <h3>Ave: <span id="averageDistance">boo</span></h3>
        <h3>Count: <span id="countDistance">boo</span></h3>
      </div>
    </div>

    <div>
      <div style="float:left;height:400px;width:600px">
        <canvas id="totalDistanceChart"></canvas>
      </div>
      <div style="padding:20px;float:left;">
        <h3>Total: <span id="totalDistance">boo</span></h3>
      </div>
    </div>

    <script>
      var rides = [];
      fetch('/rides.json')
        .then((response) => response.json())
        .then((data) => {
          rides = data;
          rides.sort(rideDateComparer);

          chart({
            data: rides,
            elementName: 'perDistanceChart',
            title: 'Ride Distance (miles)',
            type: 'bar',
            yAxisKey: 'distance',
          });

          var totalDistance = 0;
          const totals = rides.map(ride => {
            totalDistance += ride.distance;
            return {
              ...ride,
              total: totalDistance,
            };
          });

          chart({
            data: totals,
            elementName: 'totalDistanceChart',
            title: 'Total Distance (miles)',
            type: 'line',
            yAxisKey: 'total',
          });

          const maxDistance = Math.max(...rides.map(r => r.distance));
          const maxText = document.getElementById('maxDistance');
          maxText.innerHTML = maxDistance + " miles";

          const countDistance = rides.length;
          const countText = document.getElementById('countDistance');
          countText.innerHTML = countDistance;

          const averageText = document.getElementById('averageDistance');
          averageText.innerHTML = (totalDistance / countDistance).toFixed(2) + " miles";

          const totalText = document.getElementById('totalDistance');
          totalText.innerHTML = totalDistance.toFixed(2) + " miles";
        });

    </script>
  </body>
</html>
